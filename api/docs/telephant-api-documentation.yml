openapi: 3.0.0

info:
  title: Telephant API
  description: |
    *The mechanism for swapping airtime is powered by Telephant's APIs. Developers can use the API to tap into the platform's capabilities and incorporate the service into their own apps.*

    The Telephant API's backbone is HTTP. The nature of our API is RESTful. It has a set of predictable resource URLs. It returns HTTP response codes to indicate errors. It also accepts JSON as an HTTP body payload and returns it, along with some other useful formats.
    
    You can use your favorite HTTP/REST library for your programming language or an HTTP client like Postman or CURL to use Telephant's API.

    Happy programming **:-)**

    ## HTTP Response Status Codes
    HTTP response status codes show whether or not a particular HTTP request was completed successfully. Section 10 of RFC 2616 defines the status codes listed below. RFC 7231 contains an updated specification.

    Telephant API makes use of the following HTTP status codes, grouped into three classes:

    ### Successful Responses

    #### 200 - OK

    The request has succeeded.

    #### 201 - Created

    As a result of the request's success, a new resource has been generated. This is the response that is normally sent in response to POST or some PUT queries.

    ### Client Error
    
    #### 400 - Bad Request
    Due to incorrect syntax, the server was unable to understand the request.
    
    #### 401 - Unauthorized
    Authentication is required and has failed or has not yet been provided.
    
    #### 403 - Forbidden
    The server refuses to provide the requested resource because the client does not have access permissions to the resource; that is, it is unauthorized. Unlike 401, the server is aware of the client's identity.
    
    #### 404 - Not Found
    The requested resource was not found. The client is free to make additional requests.
    
    #### 405 - Method Not Allowed
    A GET request on a form that needs data to be presented via POST, or a PUT request on a read-only resource, for example, is not supported for the requested resource.

    ### Server Error

    #### 500 - Internal Server Error
    The server has come upon a circumstance that it is unsure how to handle.  Our team will be reviewing the root cause of issues and resolving the problems as soon as possible.

  terms-of-service: http://www.telephant.co.za/terms-of-service
  version: '1.0'
  contact:
    name: Telephant API Team
    url: http://developer.telephant.co.za
    email: api@telephant.co.za
  x-logo:
    url: "http://developer.telephant.co.za/telephant-documentation-logo.jpg"
    backgroundColor: "#fafafa"

servers:
  - description: Sandbox Server
    url: https://localhost:3443
  - description: Live Server
    url: https://api.telephant.co.za

tags:
- name: Accounts
  description: In addition to a user's own account, organizations such as enterprises, clubs, and homes can create accounts. Multiple users can manage an account, which has its own resources and actions.
- name: Airtime
  description: |
    Airtime is the life blood of the Telephant service.  This endpoint allows you to check an account's airtime balance, send and request airtime from your contacts.
    
    **Note:**  You'll need a verified contact in order to request or them send airtime.
- name: Contacts
  description: |
    You may view and edit an account's contacts listings, as well as add, update, and delete details contacts, using this end point.
    
    **Note:**  You'll need a verified contact in order to request or them send airtime.
- name: Notifications
  description: Review read, unread or all the notifications sent about your account. Also mark notifications as read.
- name: Retailers
  description: Obtain a public list of Telephant credit-accepting merchants. Add, delete, or edit merchant information that will be made public.
- name: Transactions
  description: View the details of a given transaction from a filtered or unfiltered list of transactions on an account.
- name: Users
  description: |
    Logging in and registering are both done through the Users interface.

    **Note:** Before you may interact with this API, you must first obtain a JWT bearer token via the signup action on the Users endpoint.
- name: Ping
  description: Ping is a utility function that can be used to test the health of the Telephant service.  The ping service only responds with 'Pong'.

x-tagGroups:
  - name: Functionality
    tags:
      - Accounts
      - Airtime
      - Contacts
      - Notifications
      - Retailers
      - Transactions
      - Users
  - name: Utility
    tags:
      - Ping

paths:
  /v1/accounts:
    get:
      summary: Get account(s).
      description: Get the details of a specific account(s). List one or all of the details of accounts available to this username.
      tags:
        - Accounts
      security:
        - BearerAuth: []
      parameters:
      - in: header
        name: x-account-id
        description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
        schema:
          type: string
          format: uuid
        required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary: Create account.
      description: Create a new group account.
      tags:
        - Accounts
      security:
        - BearerAuth: []
      requestBody:
        description: Define the properties of the account to create.
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  maxLength: 50
                  example: My Company's Airtime Account
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    put:
      summary: Update account.
      description: Update the details of a group account.
      tags:
        - Accounts
      security:
        - BearerAuth: []
      requestBody:
        description: Define the properties of the account to create.
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  maxLength: 50
                  example: My Company's Airtime Account
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete account.
      description: Delete a specific group account.
      tags:
        - Accounts
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/airtime:
    get:
      summary: Get airtime balance.
      description: Check the balance of a group or individual accounts airtime balance.
      tags:
        - Airtime
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary: Use airtime.
      description: Convert positive airtime balance for use as airtime on phone.
      tags:
        - Airtime
      security:
        - BearerAuth: []
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/airtime/{ContactsPhoneNumber}:
    get:
      summary: Request airtime.
      description: Request airtime credit from a contact.
      tags:
        - Airtime
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: ContactsPhoneNumber
          schema:
            type: string
            pattern: ^(27)[0-9]{9}$
          required: true
          description: A contact's unique mobile phone number from an accounts contacts list.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary: Send airtime.
      description: Send airtime credit to a contact.
      tags:
        - Airtime
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: ContactsPhoneNumber
          schema:
            type: string
            pattern: ^(27)[0-9]{9}$
          required: true
          description: A contact's unique mobile phone number from an accounts contacts list.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/contacts:
    get:
      summary: List the contacts of an individual or group account.
      description: List the contacts for account  
      tags:
        - Contacts
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary: Create contact.
      description: Create a contact for a individual or group account.
      tags:
        - Contacts
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/contacts/{ContactsPhoneNumber}:
    get:
      summary: View specific contact.
      description: Get the details of a specific contact for an individual or group account.
      tags:
        - Contacts
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: ContactsPhoneNumber
          schema:
            type: string
            pattern: ^(27)[0-9]{9}$
          required: true
          description: A contact's unique mobile phone number from an accounts contacts list.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    put:
      summary: Update specific contact.
      description: Update a specific contact for an individual or group account.
      tags:
        - Contacts
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: ContactsPhoneNumber
          schema:
            type: string
            pattern: ^(27)[0-9]{9}$
          required: true
          description: A contact's unique mobile phone number from an accounts contacts list.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete specific contact.
      description: Delete a specific contact for an individual or group account.
      tags:
        - Contacts
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: ContactsPhoneNumber
          schema:
            type: string
            pattern: ^(27)[0-9]{9}$
          required: true
          description: A contact's unique mobile phone number from an accounts contacts list.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/notifications:
    get:
      summary: Get list of notifications.
      description: Get the list of notifications for an individual or group account.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'
        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary:  Mark unread notifications as read.
      description: Mark all unread notifications as read on an individual or group account.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/notifications/{NotificationID}:
    get:
      summary: View specific notification.
      description: Get the details of a specific notification for an individual or group account.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: NotificationID
          schema:
            type: string
            format: uuid
          required: true
          description: Unique ID of the notification.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'
        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary: Mark notifcation as read.
      description: On an individual or group account, mark a specific notification as read.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: NotificationID
          schema:
            type: string
            format: uuid
          required: true
          description: Unique ID of the notification.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'
        '5XX':
          $ref: '#/components/responses/ServerError'
    put:
      summary: Accept or reject airtime request.
      description: Accept or reject a specific airtime send request from a contact.
      tags:
        - Notifications
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: NotificationID
          schema:
            type: string
            format: uuid
          required: true
          description: Unique ID of the notification.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /ping:
    get:
      summary: Ping the API.
      description: To make sure the API is up and working, ping the server.
      tags:
        - Ping
      responses:
        '200':
          description: This API call only returns 'pong' to confirm that the API is up and running.
          content:
            application/json:
              schema:
                properties:
                  message:
                    type: string
                    example: Pong.

  /v1/retailers:
    get:
      summary: Get retailers.
      description: Get a listing of Telephant retailers.
      tags:
        - Retailers
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary: Create a retailer listing.
      description: Create a Telephant retailer listing.
      tags:
        - Retailers
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: true
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/retailers/{RetailerID}:
    put:
      summary: Update retailer.
      description: Update a retailer listing.
      tags:
        - Retailers
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: RetailerID
          schema:
            type: string
            format: uuid
          required: true
          description: Unique ID of the retailer listing.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: true
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete retailer.
      description: Delete a retailer listing.
      tags:
        - Retailers
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: RetailerID
          schema:
            type: string
            format: uuid
          required: true
          description: Unique ID of the retailer listing.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: true
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/transactions:
    get:
      summary: Get transactions.
      description: Get a transaction listing for an individual or group account.
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      tags:
        - Transactions
      security:
        - BearerAuth: []
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/transactions/{TransactionID}:
    get:
      summary: View a transaction.
      description: View the details of a specific transaction for an individual or group account.
      tags:
        - Transactions
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: TransactionID
          schema:
            type: string
            format: uuid
          required: true
          description: Unique ID of the transaction.
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/users:
    post:
      summary: User authentication.
      description: Provides an end point to sign up as a user or log in.
      tags:
        - Users
      parameters:
        - in: query
          name: action
          schema:
            type: string
            enum:
              - signup
              - login
          description: >
            User actions:
             * `signup` - Create a user account.
             * `login` - As a user, sign in.
      requestBody:
        description: Provide the telephone number and a password to signup or login.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Users'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: 
                    type: string
                    example: 'The user was successfully registered.'
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'User successfully logged in.'
                  token:
                    type: string
                    example: 'BEARER <TOKEN STRING>'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ['User validation failed : Password not complex enough.','User validation failed : The telephone number does not conform to the South African format (27XXXXXXXXX).']
        '401':
          description: Unauthorised
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Unable to authenticate using credentials provided.'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'The telephone number already registered.'
        '5xx':
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'We are sorry but something went wrong on our side.'

  /v1/verifications:
    get:
      summary: Get verifications.
      description: Check the status of an individual or group account's verification.
      tags:
        - Verifications
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    post:
      summary: Create verifications.
      description: Submit verification requirements on a per-account or per-group basis.
      tags:
        - Verifications
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'
    put:
      summary: Update verification.
      description: Update the verification requirements for a single account or a group account.
      tags:
        - Verifications
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: x-account-id
          description: Clients can make requests as connected accounts using the special header x-account-id which should contain a Telephant account ID.
          schema:
            type: string
            format: uuid
          required: false
      responses:
        '401':
          $ref: '#/components/responses/Unauthorised'

        '5XX':
          $ref: '#/components/responses/ServerError'


components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Users:
      type: object
      properties:
        telephoneNumber:
          type: string
          pattern: ^(27)[0-9]{9}$
          description: Provide a valid South African mobile telphone number in the format 27XXXXXXXXXX.
          example: 27821234567
        password:
          type: string
          pattern: /(?=^.{8,}$)(?=.*\d)(?=.*[!@#$%^&*]+)(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/
          description: |
            Provide a suitable password.
              * The password length must be greater than or equal to 8
              * The password must contain one or more uppercase characters
              * The password must contain one or more lowercase characters
              * The password must contain one or more numeric values
              * The password must contain one or more special characters
            example: P@ssword123

    Transactions:
      type: object
      required:
        - amount
        - sign
        - type
      properties:
        accountID:
          type: string
          format: uuid
        date-time:
          type: string
          format: date-time
        amount:
          type: number
        sign:
          type: boolean
        type:
          type: string
          enum:
            - SEND
            - RECEIVE
      description: The Transactions are represented in the form of the following JSON model.

  responses:
    '4XX':
      description: Client error
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                description: |
                  Please review the documentation for [HTTP Response Status Codes] (http://developer.telephant.co.za/#section/HTTP-Response-Status-Codes)

                  Possible values are:
                    - 400 - Bad Request
                    - 401 - Unauthorized
                    - 403 - Forbidden
                    - 404 - Not Found
                    - 405 - Method Not Allowed
              name:
                type: String
              name:
                type: message


    '5XX':
      description: Server erro
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Unauthorised'
    '2XX':
      description: Success
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ServerError'